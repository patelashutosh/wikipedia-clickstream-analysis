<!--
Author: W3layouts
Author URL: http://w3layouts.com
License: Creative Commons Attribution 3.0 Unported
License URL: http://creativecommons.org/licenses/by/3.0/
-->
<!DOCTYPE HTML>
<html>

<head>
	<title>Wikipedia Clickstream Analysis</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<!-- Bootstrap Core CSS -->
	<link href="css/bootstrap.css" rel='stylesheet' type='text/css' />

	<!-- Custom CSS -->
	<link href="css/style.css" rel='stylesheet' type='text/css' />

	<!-- font-awesome icons CSS -->
	<link href="css/font-awesome.css" rel="stylesheet">
	<!-- //font-awesome icons CSS -->

	<!-- side nav css file -->
	<link href='css/SidebarNav.min.css' media='all' rel='stylesheet' type='text/css' />
	<!-- side nav css file -->

	<!-- js-->
	<script src="js/jquery-1.11.1.min.js"></script>
	<script src="js/modernizr.custom.js"></script>

	<!--webfonts-->
	<link href="//fonts.googleapis.com/css?family=PT+Sans:400,400i,700,700i&amp;subset=cyrillic,cyrillic-ext,latin-ext"
		rel="stylesheet">
	<!--//webfonts-->

	<!-- Metis Menu -->
	<script src="js/metisMenu.min.js"></script>
	<script src="js/custom.js"></script>
	<link href="css/custom.css" rel="stylesheet">
	<!--//Metis Menu -->

	<style>
		#chartdiv {
			width: 100%;
			height: 375px;
		}

		#chartdiv1 {
			width: 100%;
			height: 295px;
		}

		.jqcandlestick-container {
			width: 100%;
			height: 300px;
		}
	</style>

	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="https://code.highcharts.com/highcharts.js"></script>
	<script src="https://code.highcharts.com/modules/data.js"></script>
	<script src="https://code.highcharts.com/modules/series-label.js"></script>
	<script src="https://code.highcharts.com/modules/exporting.js"></script>
	<script src="https://code.highcharts.com/modules/export-data.js"></script>
	<script src="https://code.highcharts.com/modules/accessibility.js"></script>
	<!--<script src="https://code.highcharts.com/themes/dark-unica.js"></script>
<script src="https://code.highcharts.com/themes/high-contrast-light.js"></script> 

<script src="https://code.highcharts.com/themes/dark-blue.js"></script>
<script src="https://code.highcharts.com/themes/high-contrast-dark.js"></script>-->
	<script src="https://code.highcharts.com/themes/sunset.js"></script>

	<script src="/socket.io/socket.io.js"></script>


</head>

<body class="cbp-spmenu-push">
	<div class="main-content">
		<div class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left" id="cbp-spmenu-s1">
			<!--left-fixed -navigation-->
			<aside class="sidebar-left">
				<nav class="navbar navbar-inverse">

					<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
						<ul class="sidebar-menu">
							<li class="header">MAIN NAVIGATION</li>
							<li class="treeview">
								<a href="/chart.html">
									<i class="fa fa-dashboard"></i> <span>Dashboard</span>
								</a>
							</li>

							<li class="treeview">
								<a href="/chart.html">
									<i class="fa fa-pie-chart"></i>
									<span>Charts</span>

								</a>
							</li>

						</ul>
					</div>
					<!-- /.navbar-collapse -->
				</nav>
			</aside>
		</div>
		<!--left-fixed -navigation-->

		<!-- header-starts -->
		<div class="sticky-header header-section ">
			<div class="header-left">

				<!--toggle button start-->
				<button id="showLeftPush"><i class="fa fa-bars"></i></button>
				<!--toggle button end-->

				<!--notification menu end -->
				<div class="clearfix"> </div>
			</div>

			<div class="clearfix"> </div>
		</div>
		<!-- //header-ends -->
		<!-- main content start-->
		<div id="page-wrapper">
			<h2 class="title1">Wikipedia Clickstream Dashboard</h2>
			<div class="charts">
				<div class="col-md-4 charts-grids widget">
					<div class="card-header">
						<h3>Most accessed pages on wikipedia - cumulative</h3>
					</div>

					<div id="container1" style="width: 100%; height:270px;">
						<canvas id="canvas"></canvas>
					</div>

				</div>

				<div class="col-md-4 charts-grids widget states-mdl">
					<div class="card-header">
						<h3>Most accessed pages on wikipedia - sliding window</h3>
					</div>
					<div id="container2"></div>
				</div>

				<div class="clearfix"> </div>
			</div>


			<div class="hight-chat charts">
				<div class="col-md-6 w3ls-high charts-grids">
					<div class="hightchat-grid">

						<h4 class="title">Daily sessions</h4>
						<div id="example-1"></div>

					</div>
				</div>
				<div class="col-md-6 agileits-high charts-grids">
					<div class="hightchat-grid1">
						<h4 class="title">Browser market shares</h4>
						<div id="example-2"></div>

					</div>
				</div>
				<div class="clearfix"></div>
			</div>


		</div>

		<div class="clearfix"></div>


		<!-- new added charts  js-->
		<script type="text/javascript">

			$(document).ready(function () {
				var socket = io();
				var series;
				var chartDataFull = new Map();
				var chartDataSliding = new Map();

				function processMap(mapData) {
					var map = new Map([...mapData.entries()].sort((a, b) => b[1] - a[1]));
					return map;
				}

				function convertToArray(mapData, n) {
					var arrs = new Array();
					var i = 0;
					for (let [key, value] of mapData.entries()) {
						//console.log("value", value)
						value = parseInt(value);
						var arr = [key, value];
						arrs.push(arr);
						if (i++ == n) {
							break;
						}
					}
					return arrs;
				}

				// Highcharts.setOptions({
				//     global: {
				//         useUTC: false
				//     },
				//     lang: {
				//         thousandsSep: ','
				//     }
				// });

				var options = {
					chart: {
						type: 'column'
					},
					//title is set in the div. 
					title: {
						text: '' 
					},
					xAxis: {
						type: 'category',
						crosshair: true
					},
					yAxis: {
						min: 0,
						title: {
							text: 'View count'
						}
					},
					series: [{
						name: 'Articles',
						data: [],
					}]
				};
				//1st chart
				var chartFull = new Highcharts.Chart('container1', options);
				//chartFull.setTitle({text: "Most accessed pages on wikipedia - cumulative"});

				//2nd chart
				var chartSliding = new Highcharts.Chart('container2', options);
				//chartSliding.setTitle({text: "Most accessed pages on wikipedia - sliding window"});
				var chart = chartFull;
				var chartData;
				socket.on('message', function (msgs) {
					for (let msg of msgs) {
						console.log(msg.topic, msg.key, msg.value)

						if (msg.topic == 'top_resource') {
							chart = chartFull;
							chartData = chartDataFull;
						} else if (msg.topic == 'top_resource_sliding') {
							chart = chartSliding;
							chartData = chartDataSliding
						}

						chartData.set(msg.key, msg.value);
						chartData = processMap(chartData);
						var data = convertToArray(chartData, 10); //take top 10
						chart.series[0].setData(data);
					}
					chart.redraw();
				});

			});
		</script>

		<!-- Dummy charts-->
		<script type="text/javascript">
		// dummy chart 1
		Highcharts.chart('example-1', {

		chart: {
			scrollablePlotArea: {
				minWidth: 700
			}
		},

		data: {
			csvURL: 'https://cdn.jsdelivr.net/gh/highcharts/highcharts@v7.0.0/samples/data/analytics.csv',
			beforeParse: function (csv) {
				return csv.replace(/\n\n/g, '\n');
			}
		},

		title: {
			text: ''
		},

		xAxis: {
			tickInterval: 7 * 24 * 3600 * 1000, // one week
			tickWidth: 0,
			gridLineWidth: 1,
			labels: {
				align: 'left',
				x: 3,
				y: -3
			}
		},

		yAxis: [{ // left y axis
			title: {
				text: null
			},
			labels: {
				align: 'left',
				x: 3,
				y: 16,
				format: '{value:.,0f}'
			},
			showFirstLabel: false
		}, { // right y axis
			linkedTo: 0,
			gridLineWidth: 0,
			opposite: true,
			title: {
				text: null
			},
			labels: {
				align: 'right',
				x: -3,
				y: 16,
				format: '{value:.,0f}'
			},
			showFirstLabel: false
		}],

		legend: {
			align: 'left',
			verticalAlign: 'top',
			borderWidth: 0
		},

		tooltip: {
			shared: true,
			crosshairs: true
		},

		plotOptions: {
			series: {
				cursor: 'pointer',
				className: 'popup-on-click',
				marker: {
					lineWidth: 1
				}
			}
		},

		series: [{
			name: 'All sessions',
			lineWidth: 4,
			marker: {
				radius: 4
			}
		}, {
			name: 'New users'
		}]
		});

		//dummy chart 2
		Highcharts.chart('example-2', {
    chart: {
        type: 'pie',
        options3d: {
            enabled: true,
            alpha: 45,
            beta: 0
        }
    },
    title: {
        text: 'Browser market shares'
    },
    accessibility: {
        point: {
            valueSuffix: '%'
        }
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            depth: 35,
            dataLabels: {
                enabled: true,
                format: '{point.name}'
            }
        }
    },
    series: [{
        type: 'pie',
        name: 'Browser share',
        data: [
            ['Firefox', 45.0],
            ['IE', 26.8],
            {
                name: 'Chrome',
                y: 12.8,
                sliced: true,
                selected: true
            },
            ['Safari', 8.5],
            ['Opera', 6.2],
            ['Others', 0.7]
        ]
    }]
});
		
		</script>
		<!---Charts end---->


		<!-- Classie -->
		<!-- for toggle left push menu script -->
		<script src="js/classie.js"></script>
		<script>
			var menuLeft = document.getElementById('cbp-spmenu-s1'),
				showLeftPush = document.getElementById('showLeftPush'),
				body = document.body;

			showLeftPush.onclick = function () {
				classie.toggle(this, 'active');
				classie.toggle(body, 'cbp-spmenu-push-toright');
				classie.toggle(menuLeft, 'cbp-spmenu-open');
				disableOther('showLeftPush');
			};

			function disableOther(button) {
				if (button !== 'showLeftPush') {
					classie.toggle(showLeftPush, 'disabled');
				}
			}
		</script>
		<!-- //Classie -->
		<!-- //for toggle left push menu script -->

		<!--scrolling js-->
		<script src="js/jquery.nicescroll.js"></script>
		<script src="js/scripts.js"></script>
		<!--//scrolling js-->

		<!-- Bootstrap Core JavaScript -->
		<script src="js/bootstrap.js"> </script>

		<!-- candlestick -->
		<!-- for points and multiple y-axis charts js -->
		<script type="text/javascript" src="js/jquery.jqcandlestick.min.js"></script>
		<link rel="stylesheet" type="text/css" href="css/jqcandlestick.css" />
		<!-- //candlestick -->
		<!-- //for points and multiple y-axis charts js -->

		<!-- side nav js -->
		<script src='js/SidebarNav.min.js' type='text/javascript'></script>
		<script>
			$('.sidebar-menu').SidebarNav()
		</script>
		<!-- //side nav js -->

</body>

</html>