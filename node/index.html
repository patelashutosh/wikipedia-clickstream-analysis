<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>

<script src="/socket.io/socket.io.js"></script>

<figure class="highcharts-figure">
    <div id="container"></div>
    <p class="highcharts-description">
        Chart showing use of rotated axis labels and data labels.
    </p>
</figure>

<script type="text/javascript">
    $(document).ready(function () {
	    var socket = io();
	    var series;
        Highcharts.setOptions({
            global: {
                useUTC: false
            },
            lang: {
                thousandsSep: ','
            }
        });

        var options = {
            chart: {
            renderTo: 'container',
            type: 'column',
            options3d: {
                enabled: true,
                alpha: 0,
                beta: 0,
                depth: 0,
                viewDistance: 25
            }
            },
            title: {
                text: 'Most accessed pages on wikipedia'
            },
            subtitle: {
                text: 'Source: <a href="http://en.wikipedia.org/wiki/List_of_cities_proper_by_population">Wikipedia</a>'
            },
            xAxis: {
                type: 'Page name',
                labels: {
                    rotation: -45,
                    style: {
                        fontSize: '13px',
                        fontFamily: 'Verdana, sans-serif'
                    }
                }
            },
            yAxis: {
                min: 0,
                title: {
                    text: 'View count'
                }
            },
            legend: {
                enabled: false
            },
            tooltip: {
                pointFormat: 'View count <b>{point.y:.1f}</b>'
            },
            series: [{
                name: 'Articles',
                data: [],
                // data: [
                //     ['placeholder1', 5000],
                //     ['placeholder2', 4000]
                // ],
                dataLabels: {
                    enabled: true,
                    rotation: -90,
                    color: '#FFFFFF',
                    align: 'right',
                    //format: '{point.y:.1f}', // one decimal
                    y: 10, // 10 pixels down from the top
                    style: {
                        fontSize: '13px',
                        fontFamily: 'Verdana, sans-serif'
                    }
                }
            }]
        };
        var chart = new Highcharts.Chart(options);
        socket.on('message', function(msg){
            //console.log("Message: *****: ", msg);
            console.log(msg.key, msg.value);
            chart.series[0].addPoint([msg.key, parseInt(msg.value)]);
            chart.redraw();
        });
    });
</script>
